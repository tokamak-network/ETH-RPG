# EthÂ·RPG â€” What Hero Is Your Wallet?

Ethereum wallet RPG character card generator. Enter any wallet address and get a unique RPG character card with class, stats, AI-generated lore, achievement badges, and a shareable card image â€” all derived from real on-chain activity.

**No wallet connection required.** Only public blockchain data is used.

---

## Features

### Character Card Generation
Enter an Ethereum address (or ENS name) and receive a full RPG character profile:
- **Class** determined by on-chain behavior (8 classes)
- **Stats** calculated from transaction history (Level, HP, MP, STR, INT, LUCK)
- **Combat Power** composite score ranking your wallet's strength
- **AI Lore** a unique hero backstory generated by Claude AI
- **Pixel Art Sprite** class-specific character art that evolves with level (6 tiers per class)
- **Achievement Badges** earned from on-chain milestones (15 badges across 4 tiers)

### PvP Battle Mode
Pit two wallets against each other in a turn-based battle simulation:
- **Class matchup system** with advantage/disadvantage rings
- **8 unique class skills** and **8 passive abilities**
- **Turn-by-turn animated replay** with floating damage numbers
- **Rematch** button generates a fresh fight (nonce-based randomness)
- Every battle is shareable via URL â€” same link always replays the same fight

### Sharing
- Download card as PNG image
- Share to Twitter, Farcaster, Telegram, Discord
- OG images auto-generated for link previews (1200x630)
- UTM tracking on all share links

---

## How It Works

```
Enter wallet address (0x... or ENS)
  â†’ Fetch on-chain data via Alchemy API
  â†’ Classify transactions (NFT / DEX / Bridge / Stablecoin / Contract)
  â†’ Determine class (8-class priority matching)
  â†’ Calculate stats (logarithmic formulas)
  â†’ Evaluate achievement badges
  â†’ Generate AI lore (Claude API, with fallback templates)
  â†’ Render character card + OG image
  â†’ Display result with share options
```

---

## Character Classes

Classes are determined by **first-match priority** â€” the first condition met from top to bottom assigns the class.

| Priority | Class | Icon | Condition | Playstyle |
|:---:|-------|:---:|-----------|-----------|
| 1 | **Hunter** | :bow_and_arrow: | NFT tx ratio >= 30% | NFT collectors and traders who roam the marketplace hunting rare finds |
| 2 | **Rogue** | :dagger: | DEX swap ratio >= 25% | DEX swap specialists who thrive in the chaos of decentralized markets |
| 3 | **Summoner** | :cyclone: | Bridge tx >= 5 or ratio >= 10% | Cross-chain travelers who open portals between realms |
| 4 | **Merchant** | :moneybag: | Stablecoin ratio >= 35% | Stablecoin masters who keep their wealth steady through any storm |
| 5 | **Priest** | :orthodox_cross: | Gas > 0.5 ETH & contracts > 50 | Protocol devotees who pour their mana into smart contract rituals |
| 6 | **Elder Wizard** | :crystal_ball: | Wallet age >= 3yr & < 50 tx/yr | Ancient wallet veterans who witnessed Ethereum's earliest days |
| 7 | **Guardian** | :shield: | TX < 100 & balance > 1 ETH | Long-term ETH holders who stand watch over their vault |
| 8 | **Warrior** | :crossed_swords: | Default (no other match) | Versatile on-chain fighters with a balanced transaction profile |

---

## Stats & Formulas

All stats use **logarithmic scaling** â€” early activity has a big impact, but returns diminish at higher levels. This ensures both new and veteran wallets get meaningful scores.

### Core Stats

| Stat | Formula | Input | Range |
|------|---------|-------|-------|
| **Level** | `clamp(1 + floor(10 * log10(1 + tx_count)), 1, 60)` | Transaction count | 1 â€” 60 |
| **HP** | `round(100 + 250 * log10(1 + balance_eth))` | ETH balance | 100+ |
| **MP** | `round(80 + 220 * log10(1 + gas_spent_eth))` | Total gas spent (ETH) | 80+ |
| **STR** | `round(50 + 180 * log10(1 + dex_swaps + bridges))` | DEX + Bridge tx count | 50+ |
| **INT** | `round(50 + 180 * log10(1 + unique_contracts))` | Unique contracts interacted | 50+ |
| **LUCK** | `round(50 + 120 * log10(1 + rare_events + wallet_age_years))` | Crypto events witnessed + wallet age | 50+ |

### Combat Power

```
Power = Level * 1000
      + STR * 30
      + INT * 30
      + HP * 10
      + MP * 10
      + LUCK * 20
      + ClassBonus
```

| Class | ClassBonus |
|-------|:---------:|
| Elder Wizard | +8,000 |
| Guardian | +6,000 |
| Warrior | +3,000 |
| Summoner | +2,000 |
| Hunter / Rogue / Merchant / Priest | 0 |

---

## Achievement Badges

Badges are earned automatically based on wallet activity. They appear on the character card and in shared images.

### Legendary (Gold)
| Badge | Condition |
|-------|-----------|
| **Genesis Block** :classical_building: | First transaction before 2016 |
| **Merge Witness** :crystal_ball: | Active during The Merge (Sep 2022 +/- 7 days) |
| **Gas Titan** :fire: | Spent over 10 ETH in gas fees |

### Epic (Purple)
| Badge | Condition |
|-------|-----------|
| **Diamond Hands** :gem_stone: | 4+ year wallet with balance > 0.1 ETH |
| **Bridge Runner** :bridge_at_night: | 10+ bridge transactions |
| **Contract Sage** :scroll: | Interacted with 200+ unique contracts |
| **DEX Master** :high_voltage: | 100+ DEX swaps |

### Rare (Blue)
| Badge | Condition |
|-------|-----------|
| **NFT Collector** :framed_picture: | 40%+ of transactions are NFT-related |
| **Stable Hand** :bank: | 50%+ stablecoin transactions |
| **Veteran** :crossed_swords: | 1,000+ total transactions |
| **Whale** :whale: | Balance >= 100 ETH |
| **Survivor** :shield: | Active across 3+ major crypto crises |

### Common (Gray)
| Badge | Condition |
|-------|-----------|
| **First Step** :footprints: | At least 1 transaction |
| **Explorer** :compass: | 10+ unique contracts |
| **Gas Burner** :dash: | Gas spent > 0.1 ETH |

---

## PvP Battle System

### How Battles Work
1. Enter two wallet addresses on the `/battle` page
2. Both characters are generated via the standard pipeline
3. A random nonce creates a unique battle seed
4. The battle engine simulates up to 20 turns
5. Results are animated turn-by-turn on the result page

### Class Matchups

Two advantage rings determine matchup bonuses:

```
Ring A: Warrior â†’ Rogue â†’ Merchant â†’ Priest â†’ Elder Wizard â†’ Warrior
Ring B: Hunter â†’ Summoner â†’ Guardian â†’ Hunter
```

- **Advantaged**: deal 115% damage, receive 80% damage
- **Disadvantaged**: deal 80% damage, receive 115% damage
- **Cross-ring matchups**: always neutral

### Class Skills

Each class has a unique active skill and a passive ability:

| Class | Skill | Passive |
|-------|-------|---------|
| Warrior | **Heavy Strike** â€” STR x0.5 damage, 15% stun | Iron Will â€” +10% max HP |
| Rogue | **Arbitrage** â€” Double hit (STR x0.25 each), 35% crit on 2nd | Evasion â€” 10% dodge chance |
| Hunter | **NFT Snipe** â€” LUCK-based hybrid damage, conditional crit | Keen Eye â€” +15% crit chance |
| Merchant | **Hostile Takeover** â€” Damage + debuff opponent + buff self | Compound Interest â€” MP regen every 4 turns |
| Priest | **Divine Shield** â€” Heal + damage reduction shield | Blessing â€” Passive HP regen |
| Elder Wizard | **Ancient Spell** â€” High INT damage, partial defense bypass | Mana Well â€” 15% skill cost reduction |
| Guardian | **Counter Stance** â€” Reflect 50% incoming damage | Unbreakable â€” +20% defense + anti-burst |
| Summoner | **Portal Strike** â€” Hybrid damage + MP drain | Summon Familiar â€” Bonus damage per turn |

### Battle Mechanics
- **Turn order**: LUCK + DEX x0.3 (higher goes first)
- **Critical hits**: 8% base + LUCK x0.03% bonus, 1.8x multiplier
- **Dodge**: DEX x0.03% chance to evade
- **Win condition**: Reduce opponent HP to 0, or highest HP% after 20 turns

---

## Crypto Event Timeline

Wallets that were active during major crypto events earn LUCK bonuses and may unlock the **Survivor** badge. Recognized events:

| Date | Event | RPG Description |
|------|-------|-----------------|
| 2020-03-12 | COVID Black Swan | Survived the attack of the Black Swan |
| 2020-08-01 | DeFi Summer | Fought in the Decentralized Liberation War |
| 2021-03-11 | NFT Boom | Ushered in the Era of Ancient Relic Collecting |
| 2021-05-19 | 2021 Crash | Survived the battlefield of the Great Collapse |
| 2021-11-10 | BTC ATH $69K | Reached the first Legendary Summit |
| 2022-05-09 | Luna/Terra Collapse | Witnessed the fall of the Lunar Kingdom |
| 2022-09-15 | Ethereum Merge | Participated in the Ritual of the Great Merge |
| 2022-11-11 | FTX Bankruptcy | Endured the betrayal of the Exchange Kingdom |
| 2023-03-11 | SVB Crisis | Watched the Vault Guardians crumble |
| 2024-01-10 | BTC ETF Approval | Witnessed the arrival of the Institutional Knights |
| 2024-03-13 | BTC ATH $73K | Reached the Legendary Summit |
| 2024-11-05 | US Election/BTC Surge | Rose again with the coronation of a new King |

---

## Tech Stack

| Layer | Technology |
|-------|-----------|
| Framework | Next.js 16 (App Router, TypeScript) |
| Styling | Tailwind CSS 4 |
| Blockchain Data | Alchemy SDK (Ethereum Mainnet) |
| AI | Anthropic Claude API (lore generation) |
| Image Generation | next/og (Satori) |
| Monitoring | Sentry |
| Deployment | Vercel |
| Testing | Vitest (200+ tests) |

---

## API Reference

### POST `/api/generate`

Generate a character card for a wallet address.

```jsonc
// Request
{ "address": "vitalik.eth" }

// Response (200)
{
  "address": "0xd8dA6BF26964aF9D7eEd9e03E53415D37aA96045",
  "ensName": "vitalik.eth",
  "stats": { "level": 33, "hp": 340, "mp": 180, "str": 120, "int": 280, "luck": 95, "power": 60570 },
  "class": { "id": "hunter", "name": "Hunter", "nameEn": "Hunter" },
  "lore": "A seasoned tracker of rare digital artifacts...",
  "longLore": "In the ancient forests of the Ethereum realm...",
  "achievements": [
    { "id": "genesis", "name": "Genesis Block", "icon": "ğŸ›ï¸", "tier": "legendary", "description": "First transaction before 2016" }
  ],
  "cardImageUrl": "https://eth-rpg.vercel.app/api/card/0xd8dA...",
  "ogImageUrl": "https://eth-rpg.vercel.app/api/og/0xd8dA...",
  "cached": false
}
```

### POST `/api/battle`

Simulate a PvP battle between two wallets.

```jsonc
// Request
{ "address1": "vitalik.eth", "address2": "hayden.eth" }

// Response (200)
{
  "result": {
    "fighters": [ /* BattleFighter x2 */ ],
    "winner": 0,
    "turns": [ /* BattleAction[] */ ],
    "totalTurns": 14,
    "winnerHpRemaining": 234,
    "winnerHpPercent": 69,
    "matchup": { "fighter0Advantage": "neutral", "fighter1Advantage": "neutral" },
    "nonce": "a1b2c3d4-...",
    "battleSeed": "0xf4a3..."
  },
  "cached": false
}
```

### GET `/api/og/[address]`

Returns a 1200x630 PNG OG image for the character card.

### GET `/api/card/[address]`

Returns a 1080x1350 PNG shareable card image.

### GET `/api/og/battle/[addr1]/[addr2]?n={nonce}`

Returns a 1200x630 PNG OG image for a battle result.

### GET `/api/health`

Health check endpoint.

---

## Getting Started

### Prerequisites
- Node.js 20+
- npm

### Environment Variables

Create `.env.local` in the project root:

```env
ALCHEMY_API_KEY=           # Required â€” Alchemy API key (free tier works)
ANTHROPIC_API_KEY=         # Required â€” Claude API key for lore generation
NEXT_PUBLIC_SITE_URL=      # Required â€” Your site URL (e.g., http://localhost:3000)
SENTRY_DSN=                # Optional â€” Sentry server-side DSN
NEXT_PUBLIC_SENTRY_DSN=    # Optional â€” Sentry client-side DSN
```

### Installation

```bash
npm install
```

### Development

```bash
npm run dev
```

Open [http://localhost:3000](http://localhost:3000).

### Testing

```bash
npm test              # Run all tests
npm run test:watch    # Watch mode
npm run test:coverage # Coverage report
```

### Production Build

```bash
npm run build
npm start
```

---

## Project Structure

```
src/
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ page.tsx                          # Landing page
â”‚   â”œâ”€â”€ result/[address]/page.tsx         # Character card result
â”‚   â”œâ”€â”€ battle/
â”‚   â”‚   â”œâ”€â”€ page.tsx                      # Battle input (2 addresses)
â”‚   â”‚   â””â”€â”€ [addr1]/[addr2]/page.tsx      # Battle result + animation
â”‚   â””â”€â”€ api/
â”‚       â”œâ”€â”€ generate/route.ts             # POST: generate character
â”‚       â”œâ”€â”€ battle/route.ts               # POST: run battle
â”‚       â”œâ”€â”€ og/[address]/route.tsx        # OG image (character)
â”‚       â”œâ”€â”€ og/battle/[addr1]/[addr2]/route.tsx  # OG image (battle)
â”‚       â”œâ”€â”€ card/[address]/route.tsx      # Shareable card image
â”‚       â””â”€â”€ health/route.ts              # Health check
â”œâ”€â”€ lib/
â”‚   â”œâ”€â”€ alchemy.ts                        # Alchemy SDK integration
â”‚   â”œâ”€â”€ classifier.ts                     # Transaction classification
â”‚   â”œâ”€â”€ class.ts                          # Class determination (8 classes)
â”‚   â”œâ”€â”€ stats.ts                          # Stat calculation formulas
â”‚   â”œâ”€â”€ achievements.ts                   # Achievement badge evaluation
â”‚   â”œâ”€â”€ lore.ts                           # AI lore generation + fallback
â”‚   â”œâ”€â”€ pipeline.ts                       # Core generation pipeline
â”‚   â”œâ”€â”€ battle.ts                         # Battle simulation engine
â”‚   â”œâ”€â”€ skills.ts                         # Class skills + passives
â”‚   â”œâ”€â”€ matchups.ts                       # Class advantage matchup rings
â”‚   â”œâ”€â”€ battle-narrative.ts               # Turn â†’ RPG text
â”‚   â”œâ”€â”€ cache.ts                          # In-memory cache (TTL 24h)
â”‚   â”œâ”€â”€ rate-limit.ts                     # API rate limiting
â”‚   â”œâ”€â”€ crypto-events.ts                  # Crypto event timeline
â”‚   â””â”€â”€ types.ts                          # Shared TypeScript types
â”œâ”€â”€ components/
â”‚   â”œâ”€â”€ CharacterCard.tsx                 # Character card (front + back flip)
â”‚   â”œâ”€â”€ StatBar.tsx                       # Animated stat bar
â”‚   â”œâ”€â”€ AchievementBadge.tsx              # Single achievement badge
â”‚   â”œâ”€â”€ AchievementRow.tsx                # Badge row on card
â”‚   â”œâ”€â”€ BattleArena.tsx                   # Battle sprite arena + HP bars
â”‚   â”œâ”€â”€ BattleLog.tsx                     # Turn-by-turn battle log
â”‚   â”œâ”€â”€ BattleResult.tsx                  # Winner display + share
â”‚   â”œâ”€â”€ ShareButtons.tsx                  # Share button group
â”‚   â”œâ”€â”€ AddressInput.tsx                  # Address/ENS input
â”‚   â”œâ”€â”€ LoadingScreen.tsx                 # Loading animation
â”‚   â”œâ”€â”€ TrustBanner.tsx                   # Privacy trust banner
â”‚   â””â”€â”€ pixel-sprites/                    # Pixel art sprite components
â”œâ”€â”€ hooks/
â”‚   â”œâ”€â”€ useGenerateCharacter.ts           # Character generation hook
â”‚   â””â”€â”€ useBattle.ts                      # Battle API hook
â””â”€â”€ styles/
    â””â”€â”€ themes.ts                         # Class themes, colors, tokens
```

---

## Privacy & Security

- **No wallet connection** â€” only a public address string is needed
- **No private keys** â€” never requested, never stored
- **No personal data** â€” only publicly available blockchain data is analyzed
- **No signing** â€” no transaction signing or approval requests
- **Server-side only** â€” all API keys (Alchemy, Claude) are used server-side only
- **Input validation** â€” all addresses are validated for format and length
- **Rate limiting** â€” API endpoints are rate-limited to prevent abuse

---

## Future Plans

- [ ] Share copy A/B testing (multiple copy variants per platform)
- [ ] Product Hunt launch
- [ ] Reddit r/ethereum community showcase
- [ ] Multi-chain support (Polygon, Arbitrum, Base)
- [ ] Party system (form a team of 2-4 wallets, analyze party composition)
- [ ] Seasonal events tied to crypto market conditions

---

## License

MIT
